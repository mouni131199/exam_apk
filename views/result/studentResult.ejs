<%- include('../partials/header') %>

<div class="container mt-5">

  <!-- üîô Back Button (history-based) -->
  <div class="mb-4 text-end">
    <a href="javascript:history.back()" class="btn btn-outline-secondary btn-sm">‚Üê Back</a>
  </div>

  <h2>Results for: <%= exam.title %></h2>
  <p class="lead">Score: <%= attempt.score %> / <%= questions.length %></p>

  <% questions.forEach((q, index) => {
    const answer = attempt.answers.find((a) => a.questionId.toString() === q._id.toString());
  %>
    <div class="card mb-4">
      <div class="card-body">
        <h5>Q<%= index + 1 %>: <%= q.questionText %></h5>

        <% q.options.forEach((opt, i) => {
          const isCorrect = q.correctAnswers.includes(i);
          const selected = answer?.selectedOption.includes(i);
        %>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" disabled
              <%= selected ? 'checked' : '' %>>
            <label class="form-check-label <%= isCorrect ? 'text-success fw-bold' : '' %>">
              <%= opt %>
              <% if (isCorrect) { %> ‚úî <% } %>
            </label>
          </div>
        <% }) %>

        <% if (q.explanation) { %>
          <div class="mt-2"><small class="text-muted">Explanation: <%= q.explanation %></small></div>
        <% } %>
      </div>
    </div>
  <% }) %>
</div>

<%- include('../partials/footer') %>
